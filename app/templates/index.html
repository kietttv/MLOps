<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Purchase Prediction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <main>
        <header>
            <h1>Customer Purchase Prediction - by TVTK</h1>
            <p>
                Nhập giá trị cho mười đặc trưng hành vi và nhân khẩu học, sau đó nhận dự đoán
                liệu khách hàng có khả năng mua hàng trong chiến dịch sắp tới hay không.
            </p>
        </header>

        <section class="content">
            <form id="prediction-form">
                <div class="input-grid">
                    {% for feature in feature_schema %}
                        <div class="input-field">
                            <label for="{{ feature.id }}">{{ feature.label }}</label>
                            <input type="number" step="any" name="{{ feature.id }}" id="{{ feature.id }}" placeholder="{{ feature.hint }}" required />
                        </div>
                    {% endfor %}
                </div>

                <div class="actions">
                    <button type="submit" id="submit-button">Predict Outcome</button>
                    <span class="hint">Gợi ý: sử dụng các giá trị chuẩn hóa hoặc số liệu thực tế từ hồ sơ khách hàng.</span>
                </div>
            </form>

            <section id="result" hidden>
                <h2>Kết quả dự đoán</h2>
                <p id="result-text"></p>
            </section>
        </section>

        <footer>
            Tích hợp cùng MLflow Model Registry để bảo đảm mô hình Production luôn được cập nhật từ pipeline MLOps.
        </footer>
    </main>

    <script>
        const form = document.getElementById("prediction-form");
        const resultSection = document.getElementById("result");
        const resultText = document.getElementById("result-text");
        const submitButton = document.getElementById("submit-button");

        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            const payload = Object.fromEntries(formData.entries());

            try {
                submitButton.disabled = true;
                submitButton.textContent = "Predicting...";

                const response = await fetch("/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload),
                });

                const data = await response.json();
                resultSection.hidden = false;
                resultSection.classList.remove("success", "error");

                if (!response.ok) {
                    resultSection.classList.add("error");
                    resultText.textContent = `Lỗi: ${data.error || "Unknown error"}`;
                    return;
                }

                resultSection.classList.add("success");
                resultText.textContent = `${data.label} (prediction: ${data.prediction})`;
            } catch (error) {
                resultSection.hidden = false;
                resultSection.classList.add("error");
                resultText.textContent = `Request failed: ${error}`;
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = "Predict Outcome";
            }
        });
    </script>
</body>
</html>